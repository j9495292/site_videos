<!doctype html>
<html lang="zh-CN">
<head>
    <title>{$conf['title']} - 试看</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit">
    <link rel="stylesheet" href="__INDEX__/public.css">
    <script>APP_PATH = "{:iurl()}";</script>
    <script src="__INDEX__/js/jquery.min.js?ver={:time()}"></script>
    <script src="__INDEX__/js/swiper.min.js?ver={:time()}"></script>
    <script src="__INDEX__/public.js?ver={:time()}"></script>
    <link rel="stylesheet" href="__INDEX__/aliplayer.css" />
    <script charset="utf-8" type="text/javascript" src="https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-min.js"></script>
</head>
<body>
<main class="page">
    <div class="content-header">
        <a href="javascript:history.go(-1);" class="back">返回</a>
        <div class="title">视频试看</div>
        <div class="other"></div>
    </div>

    <div class="player-video">
        <div id="video-app"></div>
        <div id="shikan">
            <div class="box">
                <div class="tips">
                    <p class="text">尊敬的会员您好：您的试看时间已到期，请打赏视频后观看！</p>
                    <a class="btn" href="{:iurl('video_detail',['id' => $video['id']])}">立即打赏，继续观看</a>
                </div>
            </div>
        </div>
    </div>

    <div class="video-tools">
        <div class="item">
            <a id="like-ding" data-id="{$video.id}" href="javascript:;">
                <div class="icon">
                    <img src="__INDEX__/images/icon/shoucang.svg" alt="">
                </div>
                <div class="title">支持点赞</div>
            </a>
        </div>
        <div class="item">
            <a href="{:iurl('user')}">
                <div class="icon">
                    <img src="__INDEX__/images/icon/yigou.svg" alt="">
                </div>
                <div class="title">已购视频</div>
            </a>
        </div>
        <div class="item">
            <a href="{$tousu}">
                <div class="icon">
                    <img src="__INDEX__/images/icon/tousu.svg" alt="">
                </div>
                <div class="title">投诉视频</div>
            </a>
        </div>
    </div>

    <div class="video-info">
        <div class="group"><span>{$video.play_num}次播放</span><span>{$video.read_num}次打赏</span></div>
        <div class="author"><img src="__INDEX__/images/icon/bianjisvg.svg">{$video.title}</div>
        <div class="like">
            <div class="item">
                <img src="__INDEX__/images/icon/dianzan.svg">
                <span>{$video.like_num}次喜欢</span>
            </div>
        </div>
    </div>

    <div class="video-about">
        <div class="title">精彩推荐</div>
        <ul>
            {volist name="about" id="vo"}
            <li>
                <a href="{:iurl('video_detail',['id' => $vo['id']])}">
                    <div class="thumb">
                        <img src="{$vo['cover']}">
                    </div>
                    <div class="icon">
                        <span class="bg"></span>
                        <span class="play"></span>
                    </div>
                    <div class="title">{$vo['title']}</div>
                    <div class="desc">{$vo['play_num']}人观看  好评:{$vo['hp']}%</div>
                </a>
            </li>
            {/volist}
        </ul>
    </div>

    <div class="backtop"></div>

</main>
<script>
    CallFunction(['likeDing']);
    var freeTime = parseInt("{$video.shikan}"),
        Store = window.localStorage,
        Vid = "v_{$video.id}",
        isPayer = parseInt(Store.getItem(Vid)) || 0;

    if(!isPayer){
        player = new Aliplayer({
            id: "video-app",
            width: "100%",
            height: "5rem",
            source:"{$video.url}",
            cover:"{$video.cover}",
            autoplay: true,
            playsinline: false,
            x5_type: 'h5',
            encryptType:1,
        }, function (player) {

        });

        player.on('play',function () {
            if(isPayer){
                $("#shikan").show();
                $('body,html').animate({ scrollTop: 0 }, 300);
                Store.setItem(Vid,'1');
                player.dispose();
            }
        });

        player.on('timeupdate', function () {
            if(player.getCurrentTime() > freeTime){
                $("#shikan").show();
                $('body,html').animate({ scrollTop: 0 }, 300);
                Store.setItem(Vid,'1');
                player.dispose();
            }
        });
    }else{
        $("#shikan").show();
    }

</script>
</body>
</html>